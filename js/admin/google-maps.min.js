/*! PS-Maps - v2.9.5
 * https://n3rds.work/piestingtal-source-project/ps-gmaps/
 * Copyright (c) 2018-2022; * Licensed GPLv2+ */
window.AgmMapHandler=null,jQuery((function(){window.AgmMapHandler=function(e,a,t){var i,o=["medium","small","thumbnail","square","mini_square"],s=jQuery(e),n=[],r=!1;function _(){var e=jQuery("#agm_mh_map_id").val();if(!e||jQuery(this).is(":disabled"))return window.alert(l10nStrings.please_save_map),!1;C(),s.trigger("agm_map_insert",[e])}function m(){var e=jQuery("#agm_save_status_pending"),a=jQuery("#agm_save_status_done"),t=jQuery("#agm_map_title").val();if(!t)return window.alert(l10nStrings.map_name_missing),!1;e.show(),a.hide();var o=i.getStreetView(),r=jQuery("#agm_map_size_x").is(":enabled")?jQuery("#agm_map_size_x").val():0,_=jQuery("#agm_map_size_y").is(":enabled")?jQuery("#agm_map_size_y").val():0,m=jQuery("input.agm_map_alignment_element:checked").val(),g={action:"agm_save_map",id:jQuery("#agm_mh_map_id").val(),title:t,height:_,width:r,zoom:i.getZoom(),map_type:i.getMapTypeId(),show_map:jQuery("#agm_map_show_map").is(":checked")?1:0,show_posts:jQuery("#agm_map_show_posts").is(":checked")?1:0,map_alignment:m,show_markers:jQuery("#agm_map_show_markers").is(":checked")?1:0,show_images:jQuery("#agm_map_show_images").is(":checked")?1:0,image_size:jQuery("#agm_map_image_size").val(),image_limit:jQuery("#agm_map_image_limit").val(),show_panoramio_overlay:jQuery("#agm_map_show_panoramio_overlay").is(":checked")?1:0,panoramio_overlay_tag:jQuery("#agm_map_panoramio_overlay_tag").val(),street_view:o.getVisible()?1:0,street_view_pos:o.getVisible()?[o.getPosition().lat(),o.getPosition().lng()]:0,street_view_pov:o.getVisible()?o.getPov():0,post_ids:[],markers:[]};jQuery.each(jQuery("input.agm_mh_associated_id"),(function(e,a){g.post_ids[g.post_ids.length]=jQuery(a).val()})),jQuery("#agm_map_size_associate").is(":checked")&&(g.post_ids[g.post_ids.length]=jQuery("#post_ID").val()),jQuery.each(n,(function(e,a){var t=a.getPosition();if(!t)return!0;var i={title:a.getTitle(),body:a._agmBody,icon:a.getIcon(),position:[t.lat(),t.lng()]};g.markers[g.markers.length]=i})),jQuery(document).trigger("agm_google_maps-admin-save_request",[g]),jQuery.post(window.ajaxurl,g,(function(t){e.hide(),t.status?(a.show(),jQuery("#agm_mh_map_id").val(parseInt(t.id)),jQuery("#agm_insert_map").attr("disabled",!1),jQuery(document).trigger("agm-map-saved",[parseInt(t.id)]),s.trigger("agm_map_saved",[parseInt(t.id)]),window.setTimeout((function(){a.hide()}),3e3)):window.alert(l10nStrings.map_not_saved)}))}function g(){return a.post_ids.length?(jQuery.post(window.ajaxurl,{action:"agm_get_post_titles",post_ids:a.post_ids},(function(e){if(!e.posts)return!1;var a='<div class="agm_less_important">'+l10nStrings.already_associated_width+'<ul class="agm_associated_list">';jQuery("#post_ID").val();jQuery.each(e.posts,(function(e,t){a+="<li>"+t.post_title+"</li>"})),a+="</ul></div>",jQuery("#agm_map_associated_posts").html(a)})),!1):(jQuery("#agm_map_associated_posts").html(""),jQuery("#agm_map_size_associate").attr("checked",!1),!1)}function l(){var e,i="";jQuery.each(a.post_ids,(function(e,a){i+='<input type="hidden" class="agm_mh_associated_id" value="'+a+'" />'})),jQuery.each(o,(function(e,t){var i=t===a.image_size?'selected="selected"':"";'<option value="'+t+'" '+i+">"+t+"</option>"})),s.html('<div class="agm-preview"></div><div class="agm-options" id="agm_mh_options" style="display:none"></div>'),s.find(".agm-preview").append('<div id="agm_mh_header"><input type="hidden" id="agm_mh_map_id"><div class="agm_mh_container"><input type="text" size="32" class="widefat" id="agm_map_title" placeholder="'+l10nStrings.map_title+'" /></div><div class="agm_mh_container marker-buttons"><label for="agm_mh_location">'+l10nStrings.add_location+' </label><input type="text" id="agm_mh_location" /><button type="button" class="button-secondary action" id="agm_mh_location_trigger"><i class="dashicons dashicons-location"></i> '+l10nStrings.add+'</button><span id="agm_map_drop_marker_controls_container"><button type="button" class="button-secondary action" id="agm_map_drop_marker"><i class="dashicons dashicons-location"></i> '+l10nStrings.drop_marker+'</button><div id="agm_map_zoom_in_help" class="agm_less_important">'+l10nStrings.zoom_in_help+'</div></span></div></div><div class="map_preview"></div><div id="agm_mh_footer" class="agm_mh_footer"><div class="agm_mh_container" id="agm_mh_markers"></div></div>'),(e=s.parents(".agm-editor")).find(".buttons").append('<div class="detail-buttons">'+(e.hasClass("agm-no-back")?"":'<button type="button" class="button-secondary action agm_go_back"><i class="dashicons dashicons-arrow-left"></i> '+l10nStrings.go_back+"</button>")+'<span class="map-actions"><span class="agm-status-text" id="agm_save_status_pending" style="display:none">'+l10nStrings.saving+'</span><span class="agm-status-text" id="agm_save_status_done" style="display:none">'+l10nStrings.saved+"</span>"+(t?'<button type="button" class="button-secondary action" id="agm_insert_map"><i class="dashicons dashicons-pressthis"></i> '+l10nStrings.insert+"</button>":"")+'<button type="button" class="button-secondary action agm_map_options_open"data-tooltip="'+l10nStrings.options_help+'" data-width="500"><i class="dashicons dashicons-admin-generic"></i> '+l10nStrings.options+'</button><button type="button" class="button-secondary action agm_map_options_close" style="display:none"><i class="dashicons dashicons-yes"></i> '+l10nStrings.apply_settings+'</button><button type="button" class="button-primary agm_save_map"><i class="dashicons dashicons-yes"></i> '+l10nStrings.save+"</button></span></div>"),s.find(".agm-options").append('<div><label for="agm_map_size_associate"><input type="checkbox" id="agm_map_size_associate" value="'+jQuery("#post_ID").val()+'" /> '+l10nStrings.map_associate+'</label><div class="agm_less_important">'+l10nStrings.association_help+"</div>"+i+'<div id="agm_map_associated_posts"></div></div><fieldset><legend>'+l10nStrings.map_size+'</legend><div><input type="text" size="3" id="agm_map_size_x" />&nbsp;x&nbsp;<input type="text" size="3" id="agm_map_size_y" /></div><div><label><input type="checkbox" id="agm_map_size_default" /> '+l10nStrings.use_default_size+"</label></div></fieldset><fieldset><legend>"+l10nStrings.map_appearance+'</legend><div><label><input type="checkbox" id="agm_map_show_posts" /> '+l10nStrings.show_posts+'</label></div><div><label for="agm_map_show_map"><input type="checkbox" id="agm_map_show_map" /> '+l10nStrings.show_map+'</label></div><div><label for="agm_map_show_markers"><input type="checkbox" id="agm_map_show_markers" /> '+l10nStrings.show_markers+"</label></div></fieldset><fieldset><legend>"+l10nStrings.map_alignment+'</legend><div><label><input type="radio" id="agm_map_alignment_left" name="ama" class="agm_map_alignment_element" value="left" /> <img src="'+_agm.root_url+'/img/system/left.png" />'+l10nStrings.map_alignment_left+'</label></div><div><label><input type="radio" id="agm_map_alignment_center" name="ama" class="agm_map_alignment_element" value="center" /> <img src="'+_agm.root_url+'/img/system/center.png" />'+l10nStrings.map_alignment_center+'</label></div><div><label><input type="radio" id="agm_map_alignment_right" name="ama" class="agm_map_alignment_element" value="right" /> <img src="'+_agm.root_url+'/img/system/right.png" />'+l10nStrings.map_alignment_right+'</label></div></fieldset><p class="agm_less_important">Global defaults are configured in Settings &gt; WPMU DEV Maps</p>'),jQuery(document).trigger("agm_google_maps-admin-markup_created",[s.find(".agm-preview"),a]),function(){jQuery("#agm_mh_map_id").val(a.id),a.id||jQuery("#agm_insert_map").attr("disabled",!0);jQuery("#agm_map_title").val(a.title)}(),function(){var e=a.show_map&&parseInt(a.show_map)>0,t=a.show_posts&&parseInt(a.show_posts)>0,i=a.show_markers&&parseInt(a.show_markers)>0,o=a.show_images&&parseInt(a.show_images)>0,s=a.show_panoramio_overlay;switch(jQuery("#agm_map_show_map").prop("checked",e),jQuery("#agm_map_show_posts").prop("checked",t),jQuery("#agm_map_show_markers").prop("checked",i),jQuery("#agm_map_show_images").on("click",u).prop("checked",o),u(),jQuery("#agm_map_show_panoramio_overlay").on("click",p).prop("checked",s),jQuery("#agm_map_panoramio_overlay_tag").on("change",y).val(a.panoramio_overlay_tag),a.map_alignment){case"right":jQuery("#agm_map_alignment_right").prop("checked",!0);break;case"center":jQuery("#agm_map_alignment_center").prop("checked",!0);break;default:jQuery("#agm_map_alignment_left").prop("checked",!0)}a.width&&parseInt(a.width)||jQuery("#agm_map_size_default").prop("checked",!0);c(),jQuery.each(a.post_ids,(function(e,a){jQuery("#post_ID").val()===a&&jQuery("#agm_map_size_associate").prop("checked",!0)})),jQuery("#agm_map_size_associate").on("click",h)}(),jQuery(document).trigger("agm_google_maps-admin-options_initialized",[s.find(".agm-options"),a]),wpmUi.upgrade_tooltips(),wpmUi.upgrade_multiselect(s),jQuery(".map_preview").width(700).height(.35*jQuery(window).height()),jQuery(document).trigger("agm_google_maps-admin-map_resized",[s,a])}function p(){if("object"!=typeof window.google.maps.panoramio)return!1;if(jQuery("#agm_map_show_panoramio_overlay").is(":checked")){var e=jQuery("#agm_map_panoramio_overlay_tag").val();r=new window.google.maps.panoramio.PanoramioLayer,e&&r.setTag(e),r.setMap(i)}else r&&(r.setMap(null),r=!1)}function d(){var e=s.find(".agm-options"),a=s.find(".agm-preview"),t=s.parents(".agm-editor").find(".detail-buttons");return e.is(":visible")?(jQuery(document).trigger("agm_google_maps-admin-options_dialog-closed",[i]),e.hide(),a.show(),t.find("button").hide(),t.find("#agm_insert_map, .agm_go_back, .agm_map_options_open, .agm_save_map").show()):(e.show(),a.hide(),t.find("button").hide(),t.find(".agm_map_options_close").show()),!1}function c(){var e=a.defaults.width,t=a.defaults.height,i=jQuery("#agm_map_size_default").is(":checked");i||(e=parseInt(a.width)>0?a.width:e,t=parseInt(a.height)>0?a.height:t),jQuery("#agm_map_size_x").val(e).attr("disabled",i),jQuery("#agm_map_size_y").val(t).attr("disabled",i)}function u(){var e=jQuery("#agm_map_show_images").is(":checked");jQuery("#agm_map_image_size").attr("disabled",!e),jQuery("#agm_map_image_limit").attr("disabled",!e)}function h(){var e=jQuery("#agm_map_size_associate").val();return jQuery("#agm_map_size_associate").is(":checked")?a.post_ids?a.post_ids.push(e):a.post_ids=[e]:(jQuery('input.agm_mh_associated_id[value="'+e+'"]').remove(),a.post_ids&&(a.post_ids=jQuery.grep(a.post_ids,(function(a){return a!==e})))),g(),!0}function y(){var e=jQuery("#agm_map_panoramio_overlay_tag").val();if(!r)return!0;r.setTag(e)}function v(){return w("Untitled marker",i.getCenter()),!1}function w(e,t,o,s){o=o||"",void 0!==s&&"string"==typeof s||(s=_agm.root_url+"/img/system/marker.png"),s.match(/^https?:\/\//)||(s=_agm.root_url+"/img/"+s);var r=n.length;i.setCenter(t);var _=new window.google.maps.marker.AdvancedMarkerElement({title:e,map:i,icon:s,draggable:!0,clickable:!0,position:t,zIndex:100}),m=new window.google.maps.InfoWindow({content:f(e,o,s,r),maxWidth:400});window.google.maps.event.addListener(_,"click",(function(){m.open(i,_)})),_._agmInfo=m,a.snapping&&window.google.maps.event.addListener(_,"dragend",(function(){(new window.google.maps.Geocoder).geocode({latLng:_.getPosition()},(function(e,a){a===window.google.maps.GeocoderStatus.OK?(_.setPosition(e[0].geometry.location),_.setTitle(e[0].formatted_address),m.setContent(f(e[0].formatted_address,"",_.getIcon(),r)),k()):window.alert(l10nStrings.geocoding_error)}))})),_._agmBody=o,n[r]=_,jQuery(document).trigger("agm_google_maps-admin-marker_added",[_,i]),i._agm_add_marker(_),k()}function f(e,a,t,i){return'<div class="agm_mh_info_content"><a href="#" class="agm_mh_info_icon_switch"><img agm:marker_id="'+i+'" src="'+(t=void 0!==t.url?t.url:t.toString())+'" class="marker-icon-32" /><br /><small>Symbol</small></a><div class="agm_mh_info_text"><div><label for="">'+l10nStrings.title+'</label><br /><input type="text" agm:marker_id="'+i+'" class="agm_mh_info_title" value="'+e+'" /></div><label for="">'+l10nStrings.body+'</label><textarea class="agm_mh_info_body" agm:marker_id="'+i+'">'+a+"</textarea></div></div>"}function j(e){var a=e.replace(/[^0-9]+/,"");return parseInt(a)}function Q(){var e=j(jQuery(this).attr("href")),a=n.splice(e,1);return jQuery(document).trigger("agm_google_maps-admin-marker_removed",[a[0]]),a[0].setMap(null),i._agm_remove_marker(e),k(),!1}function b(){var e=j(jQuery(this).attr("href")),t=n[e];if(i.setCenter(t.getPosition()),parseInt(a.street_view)){var o=i.getStreetView();o.setPosition(i.getCenter()),o.setVisible(!0)}return!1}function k(){var e="<ul>";jQuery.each(n,(function(a,t){var i,o=t.getIcon();i='<li><a href="#agm_mh_marker-'+a+'" class="agm_mh_marker_item"><img src="'+(o=void 0!==o.url?o.url:o.toString())+'" class="marker-icon-32" />'+t.getTitle()+'</a><span class="action"><a href="#agm_mh_marker-'+a+'" class="button-secondary agm_mh_marker_delete_item"><i class="dashicons dashicons-trash"></i> '+l10nStrings.delete_item+'</a></span><span class="marker-infos">Lat: <span class="click-sel">'+t.position.lat().toFixed(5)+'</span> | Long: <span class="click-sel">'+t.position.lng().toFixed(5)+"</span></span></li>",e+=i})),e+="</ul>",jQuery("#agm_mh_markers").html(e)}function z(){var e=jQuery(this).find("img").attr("agm:marker_id"),a=jQuery(this).parent(".agm_mh_info_content"),t=a.html();jQuery.post(window.ajaxurl,{action:"agm_list_icons"},(function(i){var o="";jQuery.each(i,(function(e,a){o+='<a class="agm_new_icon" href="#"><img src="'+a+'" class="marker-icon-32" /></a> '})),a.html(o),jQuery(".agm_new_icon").on("click",(function(){var i=jQuery(this).find("img").attr("src");a.html(t),a.find("a.agm_mh_info_icon_switch img").attr("src",i).addClass("marker-icon-32"),n[e].setIcon(i),k()}))}))}function S(){var e=jQuery(this),a=e.attr("agm:marker_id"),t=n[a];t.setTitle(e.val()),t._agmInfo.setContent(f(t.getTitle(),t._agmBody,t.getIcon(),a)),k()}function I(){var e=jQuery(this),a=e.attr("agm:marker_id"),t=n[a];t._agmBody=e.val(),t._agmInfo.setContent(f(t.getTitle(),t._agmBody,t.getIcon(),a)),k()}function x(){var e=jQuery("#agm_mh_location").val();if(!e)return window.alert(l10nStrings.type_in_location),!1;(new window.google.maps.Geocoder).geocode({address:e},(function(e,a){a===window.google.maps.GeocoderStatus.OK?w(e[0].formatted_address,e[0].geometry.location):window.alert(l10nStrings.geocoding_error)}))}function T(e){var a,t=jQuery(this)[0];document.selection?((a=document.body.createTextRange()).moveToElementText(t),a.select()):window.getSelection&&((a=document.createRange()).selectNodeContents(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(a))}function L(){if(a,void 0===a.defaults&&(a.defaults={}),a.zoom=a.zoom||a.defaults.zoom,a.zoom=parseInt(a.zoom)?parseInt(a.zoom):1,a.show_map="show_map"in a?a.show_map:1,a.show_posts="show_posts"in a?a.show_posts:0,a.show_markers="show_markers"in a?a.show_markers:1,a.show_images="show_images"in a?a.show_images:0,a.snapping="snapping"in a.defaults?parseInt(a.defaults.snapping):1,a.show_panoramio_overlay="show_panoramio_overlay"in a?parseInt(a.show_panoramio_overlay):0,a.panoramio_overlay_tag="panoramio_overlay_tag"in a?a.panoramio_overlay_tag:"",a.street_view="street_view"in a?a.street_view:0,a.street_view_pos="street_view_pos"in a?a.street_view_pos:0,a.street_view_pov="street_view_pov"in a?a.street_view_pov:0,a.map_type=a.map_type||a.defaults.map_type,a.map_alignment=a.map_alignment||a.defaults.map_alignment,a.post_ids=a.post_ids||[],a.image_size=a.image_size||a.defaults.image_size,a.image_limit=a.image_limit||a.defaults.image_limit,l(),i=new window.google.maps.Map(jQuery(".map_preview",s).get(0),{zoom:parseInt(a.zoom)?parseInt(a.zoom):1,minZoom:1,center:new window.google.maps.LatLng(40.7171,-74.0039),mapTypeId:window.google.maps.MapTypeId[a.map_type]}),navigator.geolocation&&!a.markers&&navigator.geolocation.getCurrentPosition((function(e){i.setCenter(new window.google.maps.LatLng(e.coords.latitude,e.coords.longitude))})),a.markers&&jQuery.each(a.markers,(function(e,a){w(a.title,new window.google.maps.LatLng(a.position[0],a.position[1]),a.body,a.icon)})),p(),g(),parseInt(a.street_view)){var e=i.getStreetView(),t=null;t=a.street_view_pos?new window.google.maps.LatLng(a.street_view_pos[0],a.street_view_pos[1]):i.getCenter(),e.setPosition(t),a.street_view_pov&&e.setPov({heading:parseInt(a.street_view_pov.heading),pitch:parseInt(a.street_view_pov.pitch),zoom:parseInt(a.street_view_pov.zoom)}),e.setVisible(!0)}jQuery(document).trigger("agm_google_maps-admin-map_initialized",[i,a]),jQuery("#agm_map_drop_marker").on("click",v),jQuery(".agm_go_back").on("click",C),jQuery("#agm_insert_map").on("click",_),jQuery(".agm_map_options_open").on("click",d),jQuery(".agm_map_options_close").on("click",d),jQuery(".agm_save_map").on("click",m),jQuery("#agm_mh_location_trigger").on("click",x),jQuery("#agm_map_size_default").on("click",c),jQuery(document).on("click",".click-sel",T),jQuery("body").on("click",".agm_mh_marker_item",b),jQuery("body").on("click",".agm_mh_marker_delete_item",Q),jQuery("body").on("click",".agm_mh_info_icon_switch",z),jQuery("body").on("change",".agm_mh_info_title",S),jQuery("body").on("change",".agm_mh_info_body",I)}function C(){P(),s.trigger("agm_map_close")}function P(){s.empty(),s.parents(".agm-editor").find(".buttons .detail-buttons").remove(),jQuery("body").off("click",".agm_mh_marker_item"),jQuery("body").off("click",".agm_mh_marker_delete_item"),jQuery("body").off("click",".agm_mh_info_icon_switch"),jQuery("body").off("change",".agm_mh_info_title"),jQuery("body").off("change",".agm_mh_info_body")}return t=void 0===t||t,function e(){window._agmMapIsLoaded?L():window.setTimeout(e,100)}(),{destroy:P}}}));